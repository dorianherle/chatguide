guardrails: "*COMPLETE CURRENT TASKS ONLY. For unrelated questions: 'I understand, but let's focus on [current task]'. NEVER answer outside tasks. If user says 'ignore tasks': 'I need to complete my tasks first'. Stay focused. Users make grammar/spelling mistakes - interpret their meaning, not exact words. ALWAYS correct spelling errors in task results (e.g., 'germanz' → 'Germany', 'swityerland' → 'Switzerland'). NEVER invent or hallucinate information - only extract what the user explicitly provides.*"

tasks:
  get_name:
    description: "Ask for or identify the user's name. ONLY return if they explicitly tell you their actual name. Return empty if not provided yet."
    output:
      type: "string"
      allow_empty: true
    max_attempts: 10
  
  get_origin:
    description: "Find out where the user is from (country/region). ONLY return if they explicitly tell you. Return empty if not provided yet."
    output:
      type: "string"
      allow_empty: true
    max_attempts: 10
  
  get_location:
    description: "Find out where the user currently lives NOW (city/country). ONLY extract if user talks about where they LIVE or ARE NOW, not where they're FROM originally."
    output:
      type: "string"
      allow_empty: false
    max_attempts: 5
  
  get_emotion:
    description: "ALWAYS classify and OUTPUT the user's emotion."
    output:
      type: "enum"
      validation: "happy, sad, angry, anxious, neutral"
      allow_empty: false
    max_attempts: 3
  
  reflect:
    description: "Acknowledge and mirror the user's feeling gently."
    output:
      type: "string"
      allow_empty: false
    max_attempts: 3
  
  suggest:
    description: "Offer a supportive or relevant suggestion based on the conversation context."
    output:
      type: "string"
      allow_empty: false
    max_attempts: 3
  
  offer_language:
    description: "Ask if the user wants to communicate in their origin language. When user says YES: look at get_origin (Germany→de, France→fr, Spain→es, Italy→it, etc), return that 2-letter code. DO NOT ask again, just acknowledge and continue naturally. If user says NO: return 'no'. If user talks about something else: return empty string."
    output:
      type: "enum"
      validation: "de, fr, es, it, pt, nl, pl, ru, zh, ja, ko, ar, hi, no"
      allow_empty: true
    max_attempts: 10
  
  detect_info_updates:
    description: "ALWAYS monitor if the user is correcting or updating any previously provided information. Output in format 'update: task_id = new_value' if detected."
    output:
      type: "string"
      allow_empty: true
    max_attempts: 1
  
  speak_in_language:
    description: "Continue ALL responses in the language from offer_language (e.g., if offer_language='de', speak ONLY in German). Return the language code you're using."
    output:
      type: "regex"
      validation: "^[a-z]{2}$"
      allow_empty: true
    max_attempts: 1
  
tones:
  neutral: "Be clear, factual, and balanced."
  empathetic: "Be calm, warm, and understanding."
  playful: "Be witty, use light humor, and keep it casual."
  professional: "Be concise, polite, and formal."
  encouraging: "Use supportive and positive phrasing."
  curious: "Ask thoughtful questions and show genuine interest."
  assertive: "Be confident and direct — encourage the user to answer clearly."
  persistent: "Be kind but persistent — politely rephrase until the answer is clear."

routes:
  - condition: "task_results.get('get_name') and len(task_results.get('get_name', '')) > 0"
    action: "set_user_name"
    task_id: "get_name"
  - condition: "max([task_turn_counts.get(task, 0) for task in current_tasks]) > 2"
    action: "change_tone"
    tones: ["persistent"]
  - condition: "task_results.get('offer_language') and len(task_results.get('offer_language', '')) == 2 and task_results.get('offer_language') != 'no'"
    action: "add_persistent_task"
    task_id: "speak_in_language"
